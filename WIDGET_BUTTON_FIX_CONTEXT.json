{
  "issue_summary": {
    "title": "Widget Button Styling and Animation Fix",
    "description": "The current widget button on the homepage looks poor and doesn't use the site-color blue. The EnhancedWidget has a better implementation with proper animations and styling that should be adopted.",
    "severity": "MEDIUM",
    "status": "ANALYSIS_COMPLETE"
  },
  "current_problems": {
    "styling_issues": [
      "Widget button doesn't use site-color blue (primary color)",
      "Poor visual appearance compared to enhanced widget",
      "Missing proper animations for open/close states",
      "Inconsistent with design system color tokens"
    ],
    "animation_issues": [
      "Basic rotation animation instead of smooth scale animations",
      "No entrance/exit animations like enhanced widget",
      "Missing hover effects and micro-interactions",
      "No notification badge animations"
    ],
    "implementation_gaps": [
      "Current implementation uses basic CSS classes instead of design system",
      "Missing Framer Motion animations like enhanced widget",
      "No proper color token usage",
      "Inconsistent with unified design system"
    ]
  },
  "enhanced_widget_implementation": {
    "file": "components/widget/enhanced/EnhancedWidget.tsx",
    "lines": "430-450",
    "features": {
      "animated_button": {
        "description": "Uses Framer Motion with proper entrance/exit animations",
        "code_reference": {
          "component": "motion.button",
          "animations": {
            "initial": "{ scale: 0 }",
            "animate": "{ scale: 1 }",
            "exit": "{ scale: 0 }"
          },
          "styling": {
            "className": "w-14 h-14 rounded-full shadow-lg flex items-center justify-center text-white hover:scale-105 transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-blue-300",
            "style": "{ backgroundColor: config.primaryColor }"
          }
        }
      },
      "notification_badge": {
        "description": "Properly positioned notification indicator with animation",
        "code_reference": {
          "position": "absolute -right-1 -top-1 h-3 w-3 rounded-full bg-red-500 animate-pulse",
          "alignment": "8px grid aligned"
        }
      },
      "panel_animations": {
        "description": "Smooth panel open/close animations",
        "code_reference": {
          "initial": "{ opacity: 0, y: 20, scale: 0.95 }",
          "animate": "{ opacity: 1, y: 0, scale: 1 }",
          "exit": "{ opacity: 0, y: 20, scale: 0.95 }",
          "transition": "{ duration: 0.2, ease: 'easeOut' }"
        }
      }
    }
  },
  "current_implementations": {
    "ultimate_widget": {
      "file": "components/widget/design-system/UltimateWidget.tsx",
      "lines": "415-460",
      "issues": [
        "Uses WidgetIconButton component instead of direct motion.button",
        "Basic scale animation without proper entrance/exit",
        "Notification badge uses basic CSS instead of motion.div",
        "Missing hover effects and micro-interactions"
      ],
      "code_reference": {
        "button_component": "WidgetIconButton",
        "animations": {
          "initial": "{ scale: 0 }",
          "animate": "{ scale: 1 }",
          "exit": "{ scale: 0 }",
          "transition": "{ duration: parseFloat(ANIMATIONS.normal) / 1000, ease: [0.0, 0.0, 0.2, 1] }"
        }
      }
    },
    "widget_button_component": {
      "file": "components/widget/design-system/WidgetButton.tsx",
      "lines": "280-333",
      "description": "Generic button component that doesn't match enhanced widget styling",
      "issues": [
        "Uses design system tokens but not site-color blue",
        "No motion animations",
        "Basic hover effects only"
      ]
    },
    "definitive_button": {
      "file": "components/widget/DefinitiveButton.tsx",
      "lines": "15-90",
      "description": "Another button implementation with different styling",
      "issues": [
        "Uses bg-primary-600 instead of config.primaryColor",
        "Basic CSS transitions instead of Framer Motion",
        "Inconsistent with enhanced widget approach"
      ]
    }
  },
  "design_system_colors": {
    "site_color_blue": {
      "primary_color": "#3b82f6",
      "primary_600": "#2563eb",
      "primary_700": "#1d4ed8",
      "css_variable": "var(--ds-color-primary-600)",
      "tailwind_class": "bg-primary-600"
    },
    "color_tokens": {
      "file": "styles/design-system.css",
      "lines": "240-250",
      "variables": {
        "--ds-color-primary-500": "#3b82f6",
        "--ds-color-primary-600": "#2563eb",
        "--ds-color-primary-700": "#1d4ed8"
      }
    },
    "tailwind_config": {
      "file": "tailwind.config.js",
      "lines": "20-35",
      "primary_colors": {
        "500": "var(--ds-color-primary-500)",
        "600": "var(--ds-color-primary-600)",
        "700": "var(--ds-color-primary-700)"
      }
    }
  },
  "fix_implementation_plan": {
    "phase_1": {
      "title": "Adopt Enhanced Widget Button Implementation",
      "files_to_modify": [
        "components/widget/design-system/UltimateWidget.tsx",
        "components/widget/design-system/WidgetButton.tsx"
      ],
      "changes": [
        "Replace WidgetIconButton with motion.button in UltimateWidget",
        "Use config.primaryColor instead of design system tokens",
        "Add proper entrance/exit animations",
        "Implement notification badge with motion.div"
      ]
    },
    "phase_2": {
      "title": "Update Styling to Match Enhanced Widget",
      "files_to_modify": [
        "components/widget/design-system/UltimateWidget.tsx"
      ],
      "changes": [
        "Use enhanced widget's className and styling",
        "Add hover:scale-105 transition effects",
        "Implement proper focus states",
        "Add shadow-lg and rounded-full classes"
      ]
    },
    "phase_3": {
      "title": "Improve Panel Animations",
      "files_to_modify": [
        "components/widget/design-system/UltimateWidget.tsx"
      ],
      "changes": [
        "Update panel animations to match enhanced widget",
        "Use proper ease functions and durations",
        "Add scale and opacity animations",
        "Implement smooth transitions"
      ]
    }
  },
  "code_references": {
    "enhanced_widget_button": {
      "file": "components/widget/enhanced/EnhancedWidget.tsx",
      "lines": "432-448",
      "code": "motion.button\n  initial={{ scale: 0 }}\n  animate={{ scale: 1 }}\n  exit={{ scale: 0 }}\n  onClick={toggleWidget}\n  className=\"w-14 h-14 rounded-full shadow-lg flex items-center justify-center text-white hover:scale-105 transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-blue-300\"\n  style={{ backgroundColor: config.primaryColor }}\n  data-testid=\"widget-button\"\n  aria-label=\"Open chat support\"\n>\n  <ChatCircle size={24} />\n  <div className=\"absolute -right-1 -top-1 h-3 w-3 rounded-full bg-red-500 animate-pulse\"></div>\n</motion.button>"
    },
    "enhanced_widget_panel": {
      "file": "components/widget/enhanced/EnhancedWidget.tsx",
      "lines": "450-460",
      "code": "motion.div\n  initial={{ opacity: 0, y: 20, scale: 0.95 }}\n  animate={{ opacity: 1, y: 0, scale: 1 }}\n  exit={{ opacity: 0, y: 20, scale: 0.95 }}\n  transition={{ duration: 0.2, ease: \"easeOut\" }}\n  className=\"bg-white rounded-2xl shadow-2xl border border-gray-200 overflow-hidden transition-all duration-300 flex flex-col\""
    },
    "current_ultimate_widget_button": {
      "file": "components/widget/design-system/UltimateWidget.tsx",
      "lines": "435-460",
      "code": "WidgetIconButton\n  icon={<svg>...</svg>}\n  size=\"lg\"\n  onClick={toggleWidget}\n  aria-label=\"Open chat support\"\n  style={{\n    backgroundColor: config.primaryColor,\n    color: 'white',\n    boxShadow: SHADOWS.widget,\n  }}\n/>"
    }
  },
  "required_imports": {
    "framer_motion": "import { motion, AnimatePresence } from 'framer-motion';",
    "icons": "import { ChatCircle } from '@phosphor-icons/react';",
    "utils": "import { cn } from '@/lib/utils';"
  },
  "testing_requirements": {
    "visual_verification": [
      "Widget button should use site-color blue (#3b82f6)",
      "Button should have smooth scale animations on hover",
      "Notification badge should pulse with animation",
      "Panel should animate smoothly on open/close"
    ],
    "interaction_testing": [
      "Hover effects should scale button to 105%",
      "Focus states should show blue ring",
      "Click should trigger smooth animations",
      "Notification badge should be properly positioned"
    ]
  },
  "success_criteria": {
    "styling": [
      "Widget button uses config.primaryColor or site-color blue",
      "Consistent with enhanced widget appearance",
      "Proper shadow and border radius",
      "Smooth hover and focus states"
    ],
    "animations": [
      "Entrance animation with scale from 0 to 1",
      "Exit animation with scale from 1 to 0",
      "Panel animations matching enhanced widget",
      "Notification badge with pulse animation"
    ],
    "accessibility": [
      "Proper aria-labels for screen readers",
      "Focus management for keyboard navigation",
      "High contrast ratios for visibility",
      "Smooth animations that respect reduced-motion"
    ]
  },
  "files_to_modify": {
    "primary": [
      "components/widget/design-system/UltimateWidget.tsx"
    ],
    "supporting": [
      "components/widget/design-system/WidgetButton.tsx"
    ],
    "reference": [
      "components/widget/enhanced/EnhancedWidget.tsx"
    ]
  },
  "estimated_effort": {
    "complexity": "MEDIUM",
    "time_estimate": "2-3 hours",
    "risk_level": "LOW",
    "dependencies": [
      "Framer Motion already available",
      "Design system tokens already defined",
      "Enhanced widget implementation available as reference"
    ]
  }
} 